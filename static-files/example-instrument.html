<!DOCTYPE html>
<meta charset="utf-8">
<title>Example Instrument</title>
<script src="/kitchen-party.js"></script>
<script>
onload = function() {
  KitchenParty.createInstrument(function(channel) {
    channel.on('setState', function(state) {
      if (state.s && typeof(state.s) == 'string')
        for (var i = 0; i < state.s.length; i++)
          if (letters[i])
            letters[i].set(state.s[i] == '1' ? true : false);
    });

    channel.setSize(100, 100);

    var string = document.getElementById('string');
    var letters = [];
  
    function pushState() {
      var newState = {s: ''};
      letters.forEach(function(letter) {
        newState.s += letter.get() ? '1' : '0';
      });
      channel.setState(newState, true);
    }

    'html5 is cool.'.split('').forEach(function(letter) {
      var self = {
        set: function set(status) {
          span.className = status ? 'selected' : 'unselected';
        },
        get: function get() {
          return (span.className == 'selected');
        }
      };
      var span = document.createElement('span');
      span.className = 'unselected';
      span.textContent = letter;
      span.addEventListener('mouseover', function() {
        self.set(true);
        pushState();
      }, false);
      span.addEventListener('mouseout', function() {
        self.set(false);
        pushState();
      }, false);
      string.appendChild(span);
      letters.push(self);
    });
  });
};
</script>
<style>
body {
  background: #f0f0f0;
  font-family: Helvetica, sans-serif;
}

#string span {
  cursor: pointer;
}

#string span {
  -webkit-transition-property: background-color;
  -webkit-transition-duration: 0.5s;
  -moz-transition-property: background-color;
  -moz-transition-duration: 0.5s;
}

#string span.selected {
  background: yellow;
}

#string span.unselected {
}
</style>
<p id="string"></p>
